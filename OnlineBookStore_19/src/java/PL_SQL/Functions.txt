CREATE OR REPLACE TRIGGER Book_trigger
BEFORE INSERT OR UPDATE
ON book
FOR EACH ROW
DECLARE
BEGIN
	:NEW.bookid := id_seq.nextval ;
END;
/

CREATE OR REPLACE FUNCTION INSERT_AUTHOR (AUTHORNAME IN VARCHAR2,INFO IN VARCHAR2,
BIRTH IN VARCHAR2,DEATH IN VARCHAR2
)
RETURN VARCHAR2 IS

AUTHORID VARCHAR2(10) ;
BEGIN
INSERT INTO AUTHOR
VALUES (AUTHOR_id_seq.nextval,AUTHORNAME,INFO,TO_DATE(BIRTH,'YYYY-MM-DD'),TO_DATE(DEATH,'YYYY-MM-DD'));

AUTHORID:=AUTHOR_id_seq.currval;           
RETURN AUTHORID ; --return the message
END ;
/



CREATE OR REPLACE FUNCTION INSERT_PUBLISHER (PNAME IN VARCHAR2,PADDRESS IN VARCHAR2,PINFO IN VARCHAR2)
RETURN VARCHAR2 IS

PID VARCHAR2(10) ;
BEGIN
INSERT INTO PUBLICATION
VALUES (pub_id_seq.nextval,PNAME,PADDRESS,PINFO);

PID:=pub_id_seq.currval;           
RETURN PID ; --return the message
END ;
/




declare
id varchar2(10);
begin
id:=insert_publisher('w','2','1');
DBMS_OUTPUT.put_line(id);
end;
/

declare
id varchar2(10);
begin
id:=insert_category('vaab2','s');
DBMS_OUTPUT.put_line(id);
end;
/


CREATE OR REPLACE FUNCTION INSERT_CATEGORY (subCat IN VARCHAR2,cat IN VARCHAR2)
RETURN VARCHAR2 IS
CID VARCHAR2(10) ;
SUB NUMBER;
BEGIN

SELECT COUNT(SUBCATEGORYNAME) INTO SUB FROM CATEGORY
WHERE SUBCATEGORYNAME LIKE SUBCAT;

IF SUB =0 THEN

    SELECT COUNT(CATEGORYNAME) INTO SUB FROM CATEGORY
    WHERE CATEGORYNAME LIKE CAT;
    IF SUB=1 THEN

        INSERT INTO CATEGORY
        VALUES (cat_id_seq.nextval,subCat,cat);
        CID:=cat_id_seq.currval;   
    ELSE 
        CID:='-1';  
    END IF;
   

ELSE
     CID:='-2';
END IF;
  
RETURN CID ; --return the message
END ;
/


CREATE OR REPLACE FUNCTION INSERT_CATEGORY (subCat IN VARCHAR2,cat IN VARCHAR2)
RETURN VARCHAR2 IS
CID VARCHAR2(10) ;
SUB NUMBER;
BEGIN

SELECT COUNT(SUBCATEGORYNAME) INTO SUB FROM CATEGORY
WHERE SUBCATEGORYNAME LIKE SUBCAT;

IF SUB =0 THEN

        INSERT INTO CATEGORY
        VALUES (cat_id_seq.nextval,subCat,cat);
        CID:=cat_id_seq.currval;   

ELSE
     CID:='-1';
END IF;
  
RETURN CID ; --return the message
END ;
/








CREATE OR REPLACE FUNCTION INSERT_BOOK (TITLE IN VARCHAR2,AUTH IN VARCHAR2, PUB IN VARCHAR2,
CAT IN VARCHAR2, PRICE IN VARCHAR2,ISBN IN VARCHAR2, PY IN VARCHAR2, EDI IN VARCHAR2,
LAN IN VARCHAR2, PN IN VARCHAR2,DES IN VARCHAR2, QUAN IN VARCHAR2, ADMIN IN VARCHAR2,DIS IN VARCHAR2 )
RETURN VARCHAR2 IS

BID VARCHAR2(10) ;
CNT NUMBER;
PID VARCHAR2(10);
BEGIN

SELECT COUNT(*) INTO CNT FROM AUTHOR
WHERE NAME LIKE AUTH;
IF CNT=0 THEN
    BID:='-2';
    RETURN BID;
  
END IF;

SELECT COUNT(*) INTO CNT FROM PUBLICATION
WHERE NAME LIKE PUB;
IF CNT=0 THEN
    BID:='-3';
    RETURN BID; 
ELSE 
SELECT PUBLISHERID INTO PID FROM PUBLICATION
WHERE NAME LIKE PUB;
END IF;

SELECT COUNT(SUBCATEGORYNAME) INTO CNT FROM CATEGORY
WHERE SUBCATEGORYNAME LIKE CAT;

IF CNT=1 THEN

    INSERT INTO BOOK 
    VALUES (BOOK_ID_SEQ.NEXTVAL,ISBN,TITLE,PID,PRICE,EDI,PY,LAN,PN,NULL,DES,DIS,ADMIN,QUAN);

    BID:=BOOK_ID_SEQ.CURRVAL;

    INSERT_BOOKbyCATEGORY(CAT,BID);
    INSERT_WRITES(AUTH,BID);

ELSE
    BID:='-1';
END IF;

RETURN BID ; --return the message
END ;
/





